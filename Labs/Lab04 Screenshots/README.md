# Lab04 Screenshots

---

## Install
### mocha
````js
npm install mocha selenium-webdriver
````

---

## workAround
````powershell
npx mocha test_login.spec.js
````

````js
// smartSleep.js - func ext - convert alias to takeScreenshot from export side
const fs = require('fs');

async function smartSleep(driver, arg) {
  if (arg === "take_screenshot" || arg === take_screenshot) {
    let screenshot = await driver.takeScreenshot();
    fs.writeFileSync(`screenshot_${Date.now()}.png`, screenshot, 'base64');
  } else {
    await driver.sleep(arg);
  }
}

module.exports = { smartSleep };
````

````js
// test_login.spec.js
// Generated by Selenium IDE by export in javascript mocha
const { Builder, By, Key, until } = require('selenium-webdriver')
const assert = require('assert')
const { smartSleep } = require('./smartSleep')

describe('Untitled', function() {
  this.timeout(30000)
  let driver
  let vars
  beforeEach(async function() {
    driver = await new Builder().forBrowser('chrome').build()
    vars = {}
  })
  afterEach(async function() {
    await driver.quit();
  })
  it('Untitled', async function() {
    await driver.get("https://www.saucedemo.com/")
    await smartSleep(driver, "take_screenshot")
    await driver.findElement(By.id("user-name")).sendKeys("standard_user")
  })
})
````

---

## modDev - console
````js
var s=document.createElement('script');s.src='https://html2canvas.hertzen.com/dist/html2canvas.min.js';document.head.appendChild(s);s.onload=function(){html2canvas(document.body).then(function(canvas){var a=document.createElement('a');a.href=canvas.toDataURL('image/png');a.download='screenshot_saucedemo.png';a.click();alert('‚úÖ Screenshot t√©l√©charg√©!');})}
````

````js
var s=document.createElement('script');s.src='https://html2canvas.hertzen.com/dist/html2canvas.min.js';document.head.appendChild(s);s.onload=()=>html2canvas(document.body).then(c=>{var a=document.createElement('a');a.href=c.toDataURL();a.download='screenshot.png';a.click();alert('‚úÖ OK!')})
````

## modeDev\Source\Snppets\New : auto
````js
var s=document.createElement('script');
s.src='https://html2canvas.hertzen.com/dist/html2canvas.min.js';
document.head.appendChild(s);
s.onload=()=>html2canvas(document.body).then(c=>{
  var a=document.createElement('a');
  a.href=c.toDataURL();
  a.download='screenshot_'+Date.now()+'.png';
  a.click()
})
````

## login.side
````js
{
  "id": "9f2f3372-8ce7-4b68-8507-36044ec4043b",
  "version": "2.0",
  "name": "test login",
  "url": "https://www.saucedemo.com/",
  "tests": [{
    "id": "71ddaa4e-84f9-4aec-a282-0daf378d355c",
    "name": "Untitled",
    "commands": [{
      "id": "29caab23-1237-4f3a-be99-377cf769d352",
      "comment": "",
      "command": "open",
      "target": "https://www.saucedemo.com/",
      "targets": [],
      "value": ""
    }, {
      "id": "screenshot-auto-trigger",
      "comment": "Screenshot automatique via injection directe dans la page",
      "command": "executeScript",
      "target": "var script = document.createElement('script'); script.innerHTML = 'var s=document.createElement(\\'script\\');s.src=\\'https://html2canvas.hertzen.com/dist/html2canvas.min.js\\';document.head.appendChild(s);s.onload=()=>html2canvas(document.body).then(c=>{var now=new Date();var time=now.getHours().toString().padStart(2,\\'0\\')+(\\\"h\\\")+now.getMinutes().toString().padStart(2,\\'0\\')+(\\\"m\\\")+now.getSeconds().toString().padStart(2,\\'0\\')+(\\\"s\\\");var a=document.createElement(\\'a\\');a.href=c.toDataURL();a.download=\\'screenshot_\\'+time+\\'.png\\';a.click();console.log(\\'üíæ Screenshot auto t√©l√©charg√©!\\')});'; document.body.appendChild(script);",
      "targets": [],
      "value": ""
    }, {
      "id": "echo-screenshot-success",
      "comment": "Confirmation que le screenshot a √©t√© pris",
      "command": "echo",
      "target": "‚úÖ Screenshot t√©l√©charg√© ! V√©rifiez votre dossier Downloads.",
      "targets": [],
      "value": ""
    }, {
      "id": "41fb2c85-5b11-4839-9c8e-3a21fb416c8c",
      "comment": "",
      "command": "type",
      "target": "id=user-name",
      "targets": [],
      "value": "standard_user"
    }]
  }],
  "suites": [{
    "id": "2304a57f-713a-4ade-a96a-7464211c5c8b",
    "name": "Default Suite",
    "persistSession": false,
    "parallel": false,
    "timeout": 300,
    "tests": ["71ddaa4e-84f9-4aec-a282-0daf378d355c"]
  }],
  "urls": ["https://www.saucedemo.com/"],
  "plugins": [{
    "name": "./custom-screenshot-plugin.js"
  }]
}
````

---

## test CLI
````powershell
npx mocha test_login.spec.js
````
